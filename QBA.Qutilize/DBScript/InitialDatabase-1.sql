DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'QBA.Qutilize.DataAccess.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201902010953078_InitialDatabase'
BEGIN
    CREATE TABLE [dbo].[DailyTasks] (
        [DailyTaskId] [int] NOT NULL IDENTITY,
        [UserID] [int] NOT NULL,
        [ProjectID] [int] NOT NULL,
        [StartDateTime] [datetime] NOT NULL,
        [EndDateTime] [datetime] NOT NULL,
        [CreatedBy] [nvarchar](max),
        [CreateDate] [datetime] NOT NULL,
        [EditedBy] [nvarchar](max),
        [EditedDate] [datetime] NOT NULL,
        [IsActive] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.DailyTasks] PRIMARY KEY ([DailyTaskId])
    )
    CREATE TABLE [dbo].[Projects] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](200) NOT NULL,
        [Description] [nvarchar](max),
        [ParentProjectId] [int],
        [CreatedBy] [nvarchar](max),
        [CreateDate] [datetime] NOT NULL,
        [EditedBy] [nvarchar](max),
        [EditedDate] [datetime] NOT NULL,
        [IsActive] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.Projects] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Users] (
        [Id] [int] NOT NULL IDENTITY,
        [UserName] [nvarchar](200) NOT NULL,
        [Password] [nvarchar](200) NOT NULL,
        [Name] [nvarchar](200) NOT NULL,
        [CreatedBy] [nvarchar](max),
        [CreateDate] [datetime] NOT NULL,
        [EditedBy] [nvarchar](max),
        [EditedDate] [datetime] NOT NULL,
        [IsActive] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.Users] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Roles] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](200) NOT NULL,
        [Description] [nvarchar](500) NOT NULL,
        [CreatedBy] [nvarchar](max),
        [CreateDate] [datetime] NOT NULL,
        [EditedBy] [nvarchar](max),
        [EditedDate] [datetime] NOT NULL,
        [IsActive] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.Roles] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[UserProjects] (
        [User_Id] [int] NOT NULL,
        [Project_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.UserProjects] PRIMARY KEY ([User_Id], [Project_Id])
    )
    CREATE INDEX [IX_User_Id] ON [dbo].[UserProjects]([User_Id])
    CREATE INDEX [IX_Project_Id] ON [dbo].[UserProjects]([Project_Id])
    CREATE TABLE [dbo].[RoleUsers] (
        [Role_Id] [int] NOT NULL,
        [User_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.RoleUsers] PRIMARY KEY ([Role_Id], [User_Id])
    )
    CREATE INDEX [IX_Role_Id] ON [dbo].[RoleUsers]([Role_Id])
    CREATE INDEX [IX_User_Id] ON [dbo].[RoleUsers]([User_Id])
    ALTER TABLE [dbo].[UserProjects] ADD CONSTRAINT [FK_dbo.UserProjects_dbo.Users_User_Id] FOREIGN KEY ([User_Id]) REFERENCES [dbo].[Users] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[UserProjects] ADD CONSTRAINT [FK_dbo.UserProjects_dbo.Projects_Project_Id] FOREIGN KEY ([Project_Id]) REFERENCES [dbo].[Projects] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[RoleUsers] ADD CONSTRAINT [FK_dbo.RoleUsers_dbo.Roles_Role_Id] FOREIGN KEY ([Role_Id]) REFERENCES [dbo].[Roles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[RoleUsers] ADD CONSTRAINT [FK_dbo.RoleUsers_dbo.Users_User_Id] FOREIGN KEY ([User_Id]) REFERENCES [dbo].[Users] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201902010953078_InitialDatabase', N'QBA.Qutilize.DataAccess.Migrations.Configuration',  0x1F8B0800000000000400ED5CDD6EDB3614BE1FB0771074B50D6994A418B005768BC4690663CD4FE3B4D85DC048B4C355A23C91CAE20D7BB25DEC91F60A23F54B919444498E9374C68021A6C48FE71CF27CA4CE39ECBF7FFF337AFB10F8D63D8C080AF1D8DEDFDDB32D88DDD0437831B6633A7FF583FDF6CDD75F8DDE79C183F5297FEF357F8FF5C4646CDF51BA3C741CE2DEC10090DD00B95148C239DD75C3C0015EE81CECEDFDE8ECEF3B9041D80CCBB2465731A62880C90FF6731262172E690CFCB3D0833EC9DAD99359826A9D8300922570E1D8FE707CB4FB21A6C8477FC0DD1340C191EB4242923F93DEB675E423C0049B417F6E5B00E39002CAC43EFC48E08C46215ECC96AC01F8D7AB2564EFCD814F60A6CE61F9BAA9667B075C33A7EC9843B931A161D01170FF75662A47EEDECBE076614A66CC77CCE874C5B54E0C3AB64F00F257D7807CB62D79B4C3891FF1370D0CBE5BC0EC58352FEF144B87AD30FEDF8E35897D1A47708C614C23E0EF5897F1AD8FDC9FE1EA3AFC0CF118C7BE2F4ACFE467CF2A0DACE9320A9730A2AB2B3897759A7AB6E554011C19A1E8AFEB9CAA3FC5F4F5816D9D3371C0AD0F8BE522986A46C308FE04318C0085DE25A014466CB6A71E4C0CAE88210DCA9665343D691BAF1983FDFC15BA7428CC8C8288B26983D7CC3B73A8F27747B477D85B1BD62482DCB8C7AB1C897932E328DB3A030FEF215ED0BBB1CDFEB4AD53F400BDBC2583FE8811A334D68946B1E1485CD0E106F0D066644E075A8BCC5372E452745F001D87A10F016EC1193925B934524EB65087114E06F21CE8A60FCB6C925CF8FF1B961FDB2A8C965FC7457402891BA165BA6D3DF2DABF041133454E80B269B7ACF2825985E19C837BB4483C41B36B12DBBA827EF294DCA1657AE4DBE54F6EB2F5C0DE388DC2E02AF4B32EC5839B6B102D2023A2EB50F77416C691DB97E438D43086E3085B7A333B3B3D0DC55D02427E0F236FF3233F8DBE5BAA7CB1545972617FB6CCF950CF9639979A4AC431F4E2F0273719B797B294AD0A6D0B8F067136C719C6D91C61CBD92FFB48FAFD963CB7E46978CE6CA52A9933352C6642554784842E4A4617642A39BBAAC83BEC598D049ECE654EFD6C3A190DA125231E36F4D8FE4EB14C1D6041C42560F171DF883972048D9A15154C5C2794CEDEA54429AB9BABA8DB683A19AC56B9746E2721A60031E6CC14CC778A2C72AD6C3F6CC46C0722992FC99273D419A4720093ADC9723565E20BE15EC5005598F23CA0801473DC02913986D23FB5614BE7EC7CA0744EA753EA2C18BC3ABC70AC11DED19E7BE45DB5CD8B0A810B451D53887C5D0910A59CF2BE5DD5CD406F919454A5EBFCA9CDA30459B3A9695057E3436DE66A503467C5C273CAE490936687F22C925393461A9D81E592ED5C425A296BB166694E69F26AD63DBB12A4188E4B34499642DA62247666020B283D654333494F514478D41DDC02BE334DBC4079ADCA1335CE938FA550813A57B95FE55DF8DF192399A77B64DCD2B0A74CD7809D0613B5A130FB0D7D936C1FF041D4949399847E1CE0D64C4F135E9E6E11A1F236731421E1220209CDE65852D645C4931E996356722F2262E581399E708215D184E6AE58E9794F054BDB3B685A1C532B6A16AD5D9154B9C47673B4F2282A6295AD2AD2C891DC47F65B47715C8945652A30228A864D70084DE40785EE2451DBB3D6D41233742384F47B54EC9FB6982354BE2D2B14253EE8402E724AA34231F2C3AD136F9DD8AE3BD40DF1E0E4A8DEDD7DF5DD1EC777CBF8BFBC9D77F5E1329E5F75B6BC75937CB2F5D32FD64FD3CFA7F5FA69F255DCDD4FF5DDFE2F7BECD6C75EBE8F558306EA86280480BAEE7B4257DDFE567344E55110CD0EA5C48F544B19F95C82A5733C6EA862E0AE3265419A9E3265301DC592033E9DA7578C7375E5CABC9F8E107587178D05D518594FF325406B985235E8B6B935D63E994A104F7EA5608A22982705ED465900ADBD405C89A8A5AFD81693FD1E793C9A365B110A836455ECCE7EF3273E62DC54BE7006309A4342D334AC7DB0B77F2015953F9F026F8710CF37ADF2EE914C5E773935E2866E4D2077CCFA552BA8932186D64FF701D1564F7BEC375D53F5746F2C25FF8CEF41E4DE81E89B003C7C2BC2F5CB31F75752CA310F924BCD23F7964BCE23DFA2B6E5D0B902BA87330EABEC7814D74B8FF1D5C953CB3986D76A0C5A183525C2928F9B2FFDAD233D0747528F6A2FD68BE432D6B579925CA5BA36E0479176EB5DCFC7BBD4E8D08BF5AE4DEF516A45E1D60F5EAC1FD4467BCCDCA1FE735A7DB73E94D2EE42C538821F29D56453ECC187B1FD67D2E7D09AFE729375DBB12E22F6E17B68ED597FF5FD76EA317AD9B383009D18ACEF19A13E2C633CC5ED73560CD2CD6A59B74173B6B1E5D2B3A8551B55934AEA5A4B33F79540DE053E813EA4D0E274C1033613405CE0A9E6E2B1AEA6B18B2A484904B30A5806C7960FE41F2508F89310131A01A486C72F23845DB404BEA8B51AD733D984B94E059CFCE4042E21E6BBAB464393E11A628605B464DF36FD3B1409B747B385C9D34D5CCDA47D71CBA7CB946E780535671136B0885A02FA52796B6B8DF923AD9D624B93C7372BE5EFB56A6AB2CB6B5F3275D9978EFBF386174B0BDD3CE53EF5148B65533B54A7C5B2C9ED497FCD43ADF29627ADE61A47F32D8E34B3C5BE9B6E4336C9E9194CBC016276CBA3E992876E8432336E7005A4F606880E597F37407739A4F66E880E567B65412B6DBD452A4FEB6437B64CE9855A35EA2D943F558768BF0553DCE668B90C5393D156584D2EF96BBB02231957A9A5187EF9457FD1A64D5D7DBE5C7766D4D4283FBDD29AEB3A4D177FDA6757F4AFB250ACEDC68FB226CAC675AA583FA9AD15108316F0BA54EC709D49AD7860FB92F00FE7B14D91A04509C1FF193D0CDDCA8E54BC33C5F330DF192589F257A410C119A4C0E32534114573E0F2F419AFA549AE007F027ECC2378C12DF4A6F822A6CB9832956170EB570AD4F806DB347E7267AB2AF3E82289A99275A8C0C4443CA678818F63E47B85DCA79A38450D04DFB9B350349F4BCA43D28B5581741E6243A0CC7CC581E31A064B9F81910B3C033C72D95D36B6F4DEC305705779E14A3D48FB4454CD3E3A41601181806418657FF693AD612F7878F31FB5DFFD4F3F520000 , N'6.2.0-61023')
END

